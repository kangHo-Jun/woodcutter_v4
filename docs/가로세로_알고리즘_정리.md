# 가로·세로 관통 절단 알고리즘 정리

## 0. 대원칙 (불변 규칙)

아래 규칙은 **어떤 상황에서도 변경되지 않는 절대 규칙**이다.

1. **모든 절단은 관통 절단(Guillotine Cut)이다**
   - 절단은 중간에 멈추지 않는다
   - 부분 절단, L자 절단, 비관통 절단은 금지

2. **첫 원장은 가로 또는 세로 어느 방향으로도 절단할 수 있다**
   - 방향은 고정값이 아니라 *판단 결과*로 결정된다

3. **1차 조각은 반드시 첫 원장 절단의 ‘반대 방향’으로 절단한다**
   - 첫 원장을 가로로 잘랐다면 → 1차 조각은 세로 절단
   - 첫 원장을 세로로 잘랐다면 → 1차 조각은 가로 절단

4. **2차 조각부터는 가로·세로 구분 없이 절단한다**
   - 단, 항상 관통 절단 원칙은 유지된다

---

## 1. 문제 정의

- 원장 크기: 2440 × 1220
- 입력: 다양한 크기의 직사각형 부품 집합
- 목표:
  - 관통 절단만 사용
  - 판재 효율(사용 면적 비율)을 최대화
  - 절단 흐름이 예측 가능하고 재현 가능하도록 유지

---

## 2. 알고리즘의 핵심 사고 전환

기존 접근은 “가로 우선” 또는 “세로 우선”을 **고정 규칙**으로 두었다.

본 알고리즘에서는 이를 폐기하고 다음 사고로 전환한다.

> **첫 원장의 절단 방향은 ‘효율 비교’로 결정한다**

즉,
- 가로 우선 알고리즘
- 세로 우선 알고리즘

을 **동시에 시뮬레이션**하고,

→ 더 효율이 높은 쪽을 실제 절단 방향으로 채택한다.

---

## 3. 1단계: 첫 원장 절단 방향 결정

### 3.1 후보 방향

- 후보 A: 첫 원장을 **가로 관통 절단**
- 후보 B: 첫 원장을 **세로 관통 절단**

두 경우 모두 동일한 규칙으로 평가한다.

### 3.2 평가 기준 (효율 함수)

각 후보 방향에 대해 아래 지표를 계산한다.

- 배치 가능 부품 총 면적
- 생성되는 1차 조각의 활용 가능성
- 슬리버(의미 없는 얇은 조각) 발생 여부
- 잔여 직사각형의 “연결성” (큰 덩어리 유지 여부)

이를 종합하여 **판재 효율 점수(Efficiency Score)** 를 계산한다.

```
Efficiency Score =
  (배치된 부품 면적 / 원장 면적)
  - 슬리버 패널티
  - 단절 패널티
```

### 3.3 첫 절단 방향 선택

- 가로 / 세로 두 시나리오 중
- **Efficiency Score가 더 높은 방향**을
- 실제 첫 원장 절단 방향으로 확정한다.

> 이 단계가 끝나면 방향은 고정된다.

---

## 4. 2단계: 1차 조각 처리 (반대 방향 절단)

### 4.1 1차 조각의 정의

- 첫 원장을 관통 절단하여 생성된 직사각형 조각들
- 모든 1차 조각은 동일한 절단 방향의 결과물이다

### 4.2 절단 규칙 (불변)

- **반드시 첫 절단과 반대 방향으로 관통 절단**

예시:
- 첫 절단 = 가로 → 1차 조각은 세로 절단
- 첫 절단 = 세로 → 1차 조각은 가로 절단

### 4.3 목적

- 큰 직사각형을 가능한 오래 유지
- 하부 또는 측면에 **연결된 큰 잔여 영역** 생성
- 이후 소형 부품이 들어갈 공간 확보

---

## 5. 3단계: 2차 조각 이후의 일반화 처리

### 5.1 상태 변화

- 2차 조각부터는 크기가 충분히 작아짐
- 더 이상 “방향 강제”의 의미가 줄어듦

### 5.2 절단 규칙

- 가로 / 세로 구분 없이
- **가장 많은 부품이 들어가는 방향**으로 관통 절단

단, 다음은 항상 유지된다.
- 관통 절단 원칙
- 슬리버 금지 규칙

### 5.3 재귀 구조

- 생성된 모든 직사각형은 다시 ‘원장’으로 취급
- 더 이상 효율 개선이 없을 때까지 반복

---

## 6. 전체 알고리즘 흐름 요약

```text
[입력] 부품 집합
   ↓
[1] 첫 원장 가로/세로 절단 시뮬레이션
   ↓
[2] 효율 점수 비교 → 방향 확정
   ↓
[3] 첫 원장 관통 절단
   ↓
[4] 1차 조각을 반대 방향으로 관통 절단
   ↓
[5] 2차 조각부터는 자유 방향 관통 절단
   ↓
[6] 모든 조각을 다시 원장으로 보고 재귀 처리
```

---

## 7. 이 알고리즘의 본질

이 알고리즘의 핵심은 ‘가로냐 세로냐’가 아니다.

> **언제 방향을 고정하고, 언제 방향을 풀어주는가**

- 방향 고정 구간: 1단계, 2단계
- 방향 자유 구간: 3단계 이후

이 구조 덕분에:
- 절단은 항상 단순하고
- 결과는 예측 가능하며
- SketchCut과 유사한 효율에 수렴한다

---

## 8. 결론

- 불변 규칙을 명확히 정의함으로써
- 알고리즘의 자유도와 안정성을 동시에 확보했다

이 문서는 **가로·세로 논쟁을 끝내고**,
> “효율로 방향을 결정하는 관통 절단 알고리즘”

의 기준 문서로 사용된다.

---

(문서 끝)

