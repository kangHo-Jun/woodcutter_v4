<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1A1A1A">
    <title>ÎåÄÏû•Í∞Ñ V3</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Step Indicator -->
        <header class="app-header">
            <div class="logo">ÎåÄÏû•Í∞Ñ <span class="version">V3</span></div>
            <div class="step-indicator">
                <span class="step active" data-step="1">ÏÑ§Ï†ï</span>
                <span class="step-dot"></span>
                <span class="step" data-step="2">ÏûÖÎ†•</span>
                <span class="step-dot"></span>
                <span class="step" data-step="3">Í≤∞Í≥º</span>
            </div>
        </header>

        <!-- Step 1: Board Size (Simplified) -->
        <section class="screen active" id="step1">
            <div class="screen-content">
                <h2 class="screen-title" style="margin-top: var(--space-xl); text-align: center;">ÏõêÌåê ÌÅ¨Í∏∞</h2>
                <p class="section-subtitle"
                    style="text-align: center; color: var(--text-dim); margin-bottom: var(--space-xl);">Ïû¨Îã®Ìï† ÏõêÌåê ÏÇ¨Ïù¥Ï¶àÎ•º
                    ÏûÖÎ†•ÌïòÏÑ∏Ïöî</p>

                <!-- Board Input Fields (One Row) -->
                <div class="input-display board-input-row">
                    <div class="input-field active" data-board-field="boardWidth">
                        <span class="field-label">Í∞ÄÎ°ú</span>
                        <span class="field-value"><span id="displayBoardWidth">2440</span><span
                                class="field-unit">mm</span></span>
                    </div>
                    <div class="input-separator-x">√ó</div>
                    <div class="input-field" data-board-field="boardHeight">
                        <span class="field-label">ÏÑ∏Î°ú</span>
                        <span class="field-value"><span id="displayBoardHeight">1220</span><span
                                class="field-unit">mm</span></span>
                    </div>
                </div>

                <!-- Hidden inputs for logic compatibility -->
                <input type="number" id="boardWidth" value="2440" class="hidden">
                <input type="number" id="boardHeight" value="1220" class="hidden">
                <input type="number" id="boardThickness" value="18" class="hidden">
                <input type="number" id="kerfInput" value="4.2" class="hidden">
                <input type="checkbox" id="preCutting" class="hidden">
            </div>

            <div class="screen-footer">
                <button class="btn btn-primary btn-lg" id="toStep2Btn">
                    Îã§Ïùå
                </button>
            </div>
        </section>

        <!-- Step 2: Parts Input -->
        <section class="screen" id="step2">
            <div class="screen-content fixed-layout">
                <header class="screen-header-simple">
                    <h2 class="screen-title-small">Ï†àÎã® ÏûÖÎ†•</h2>
                    <div class="parts-count-badge" id="partsCount">Ï†àÎã® 0Í∞ú</div>
                </header>

                <!-- Expanded Parts List (Dominant Area) -->
                <div class="parts-section-expanded">
                    <div class="parts-header-mini">
                        <span class="section-lbl">Î™©Î°ù</span>
                        <button class="link-btn-danger" id="clearAllBtn">Ï†ÑÏ≤¥ÏÇ≠Ï†ú</button>
                    </div>
                    <div class="parts-list-scroll" id="partsList">
                        <!-- Empty State Placeholder -->
                        <div class="empty-state" id="emptyState">
                            <span class="empty-icon">üì¶</span>
                            <span class="empty-text">ÏïÑÏßÅ Î∂ÄÌíàÏù¥ ÏóÜÏäµÎãàÎã§</span>
                            <span class="empty-hint">ÏïÑÎûòÏóêÏÑú Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî ‚Üì</span>
                        </div>
                    </div>
                </div>

                <!-- Run Optimization (Floating above input bar) -->
                <div class="calculate-action-area">
                    <button class="btn btn-calculate-main" id="calculateBtn">ÏµúÏ†ÅÌôî Ïã§Ìñâ</button>
                </div>
            </div>

            <!-- FIXED BOTTOM INPUT BAR -->
            <div class="bottom-input-bar">
                <div class="input-row-fixed">
                    <!-- Width Input -->
                    <div class="input-box-compact" data-field="width">
                        <span class="box-label">Í∞ÄÎ°ú</span>
                        <span class="box-value" id="inputWidth">0</span>
                        <span class="box-unit">mm</span>
                    </div>

                    <div class="input-separator-x">√ó</div>

                    <!-- Height Input -->
                    <div class="input-box-compact" data-field="height">
                        <span class="box-label">ÏÑ∏Î°ú</span>
                        <span class="box-value" id="inputHeight">0</span>
                        <span class="box-unit">mm</span>
                    </div>

                    <div class="input-separator-x">√ó</div>

                    <!-- Quantity Input (Keypad) -->
                    <div class="input-box-compact qty-box" data-field="qty">
                        <span class="box-value" id="inputQty">0</span>
                        <span class="box-unit">Í∞ú</span>
                    </div>

                    <!-- Grain Toggle Card -->
                    <div class="grain-toggle-icon" id="grainToggle">
                        <div class="grain-icon-box">
                            <div class="grain-pattern-mini"></div>
                        </div>
                        <span class="grain-label-tiny">Í≤∞ Í≥†Ï†ï</span>
                    </div>

                    <!-- Add Button -->
                    <button class="btn btn-add-compact" id="addPartBtn">+</button>
                </div>
            </div>

            <!-- Hidden inputs remain for logic compatibility -->
            <input type="checkbox" id="partRotatable" checked class="hidden">
        </section>

        <!-- Custom Keypad (Popup Style) -->
        <div class="keypad-popup-overlay hidden" id="keypadOverlay">
            <div class="keypad-popup">
                <!-- Large Input Display Area -->
                <div class="keypad-display-section">
                    <div class="keypad-field-name" id="keypadFieldLabel">Í∞ÄÎ°ú</div>
                    <div class="keypad-large-value">
                        <span id="keypadPreview">0</span><span class="unit" id="keypadUnit">mm</span>
                    </div>
                    <div class="validation-warning" id="validationWarning"></div>
                </div>

                <div class="keypad-grid">
                    <button class="key" data-key="1">1</button>
                    <button class="key" data-key="2">2</button>
                    <button class="key" data-key="3">3</button>
                    <button class="key" data-key="4">4</button>
                    <button class="key" data-key="5">5</button>
                    <button class="key" data-key="6">6</button>
                    <button class="key" data-key="7">7</button>
                    <button class="key" data-key="8">8</button>
                    <button class="key" data-key="9">9</button>
                    <button class="key key-back" data-key="‚Üê">‚Üê</button>
                    <button class="key" data-key="0">0</button>
                    <button class="key key-confirm" data-key="done">‚úì</button>
                </div>
            </div>
        </div>

        <!-- Step 3: Results (Bottom Sheet Style) -->
        <section class="screen result-screen" id="step3">
            <div class="result-content">
                <!-- Top Summary Bar -->
                <div class="result-summary-bar">
                    <div class="summary-card">
                        <span class="summary-icon">üí∞</span>
                        <span class="summary-val" id="statCost">0Ïõê</span>
                        <span class="summary-lbl">ÏòàÏÉÅ ÎπÑÏö©</span>
                    </div>
                    <div class="summary-card">
                        <span class="summary-icon">‚úÇÔ∏è</span>
                        <span class="summary-val" id="statCuts">0Ìöå</span>
                        <span class="summary-lbl">Ï†àÎã® ÌöüÏàò</span>
                    </div>
                    <div class="summary-card">
                        <span class="summary-icon">üì¶</span>
                        <span class="summary-val" id="statBoards">0Ïû•</span>
                        <span class="summary-lbl">ÏÇ¨Ïö© ÏõêÌåê</span>
                    </div>
                </div>

                <div class="result-inner">
                    <div class="board-label" id="boardSizeLabel">1220 √ó 2440 mm</div>

                    <div class="result-canvas-wrapper">
                        <canvas id="resultCanvas"></canvas>
                        <div class="zoom-controls">
                            <button class="zoom-btn" id="zoomOut">‚àí</button>
                            <span class="zoom-lvl" id="zoomLevel">100%</span>
                            <button class="zoom-btn" id="zoomIn">+</button>
                        </div>
                    </div>

                    <div class="canvas-controls">
                        <button class="canvas-ctrl" id="prevBoard">‚óÄ</button>
                        <span class="board-indicator" id="boardIndicator">1/1</span>
                        <button class="canvas-ctrl" id="nextBoard">‚ñ∂</button>
                    </div>

                    <div class="efficiency-text">Î∞∞Ïπò Ìö®Ïú® <span class="efficiency-val" id="statEfficiency">0%</span></div>

                    <!-- UI2: Legend for small parts -->
                    <div class="legend-section" id="legendSection"></div>
                </div>
            </div>

            <div class="screen-footer triple">
                <button class="btn btn-secondary" id="backToInputBtn">‚Üê Îã§ÏãúÏûÖÎ†•</button>
                <button class="btn btn-share" id="shareBtn">üì§ Í≥µÏú†</button>
                <button class="btn btn-primary" id="downloadPdfBtn">üìÑ PDF</button>
            </div>
        </section>
    </div>

    <!-- PDF Preview Modal -->
    <div class="pdf-modal-overlay hidden" id="pdfModal">
        <div class="pdf-modal">
            <div class="pdf-modal-header">
                <span>PDF ÎØ∏Î¶¨Î≥¥Í∏∞</span>
                <button class="pdf-close-btn" id="pdfCloseBtn">√ó</button>
            </div>
            <div class="pdf-modal-content">
                <canvas id="pdfPreviewCanvas"></canvas>
            </div>
            <div class="pdf-modal-footer">
                <button class="btn btn-secondary" id="pdfDownloadBtn">üì• Ï†ÄÏû•</button>
                <button class="btn btn-primary" id="pdfShareBtn">üì§ Í≥µÏú†</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/packer.js"></script>
    <script src="js/renderer.js"></script>
    <script src="js/app.js"></script>
</body>

</html>