<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>대산 Ai - 재단 최적화</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="css/responsive-style.css">

    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <h1>대산 Ai</h1>
        <div class="header-buttons">
            <button class="btn btn-secondary" id="saveBtn" title="저장하기">
                <span class="btn-text">저장하기</span>
            </button>
            <button class="btn btn-primary" id="newBtn" title="새 프로젝트">
                <span class="btn-text">새 프로젝트</span>
            </button>
        </div>
    </header>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
        <div class="mobile-nav-tabs">
            <button class="mobile-nav-tab active" data-panel="left">입력</button>
            <button class="mobile-nav-tab" data-panel="center">도면</button>
            <button class="mobile-nav-tab" data-panel="right">결과</button>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Left Panel: Input -->
        <aside class="left-panel active" id="leftPanel">
            <!-- Board Info -->
            <section class="section">
                <h2 class="section-title">판재 정보</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="boardWidth">폭 (mm)</label>
                        <input type="number" id="boardWidth" value="2440" min="100" max="5000">
                    </div>
                    <div class="form-group">
                        <label for="boardHeight">높이 (mm)</label>
                        <input type="number" id="boardHeight" value="1220" min="100" max="5000">
                    </div>
                    <div class="form-group">
                        <label for="boardThickness">두께 (mm)</label>
                        <input type="number" id="boardThickness" value="18" min="1" max="100">
                    </div>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="considerGrain">
                    <label for="considerGrain">나무결 방향</label>
                </div>
                <!-- 트리밍 옵션 (고급설정에서 이동) -->
                <div class="form-row" style="margin-top: 12px; align-items: center;">
                    <div class="checkbox-group" style="flex: 1; margin-bottom: 0;">
                        <input type="checkbox" id="enableTrim" checked>
                        <label for="enableTrim">전단여부</label>
                    </div>
                    <div class="form-group mb-0" style="flex: 1; display: flex; align-items: center; gap: 8px;">
                        <label for="trimMargin" style="margin-bottom: 0; white-space: nowrap;">여백</label>
                        <input type="number" id="trimMargin" value="5" min="0" max="50" style="width: 70px;">
                        <span style="font-size: 12px; color: #666;">mm</span>
                    </div>
                </div>
            </section>

            <!-- Parts Input -->
            <section class="section">
                <h2 class="section-title">부품 목록</h2>

                <!-- Quick Add Form -->
                <div class="form-row mb-3">
                    <div class="form-group mb-0">
                        <label for="partWidth">폭</label>
                        <input type="number" id="partWidth" placeholder="mm" min="10" step="0.1">
                    </div>
                    <div class="form-group mb-0">
                        <label for="partHeight">높이</label>
                        <input type="number" id="partHeight" placeholder="mm" min="10" step="0.1">
                    </div>
                    <div class="form-group mb-0">
                        <label for="partQty">수량</label>
                        <input type="number" id="partQty" value="1" min="1" max="999">
                    </div>
                </div>

                <div class="form-row mb-3">
                    <div class="checkbox-group" style="flex: 1;">
                        <input type="checkbox" id="partRotatable" checked>
                        <label for="partRotatable">회전 가능</label>
                    </div>
                    <button class="btn btn-primary" id="addPartBtn" style="flex: 1;">
                        부품 추가
                    </button>
                </div>

                <!-- Parts Table -->
                <div class="parts-table-container">
                    <table class="parts-table">
                        <thead>
                            <tr>
                                <th>폭</th>
                                <th>높이</th>
                                <th>수량</th>
                                <th>회전</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="partsTableBody">
                            <tr class="empty-row">
                                <td colspan="5">부품을 추가하세요</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="form-row mt-3">
                    <button class="btn btn-danger btn-sm" id="clearPartsBtn" style="flex: 1;">
                        전체 삭제
                    </button>
                </div>
            </section>

            <!-- Advanced Settings (Accordion) -->
            <section class="section" style="padding: 0;">
                <div class="accordion" id="advancedSettings">
                    <div class="accordion-header">
                        <span>고급 설정</span>
                        <span class="accordion-icon">▼</span>
                    </div>
                    <div class="accordion-body">
                        <div class="form-group">
                            <label for="kerfInput">톱날 두께 (mm)</label>
                            <input type="number" id="kerfInput" value="4.2" min="0" max="10" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="cutDirection">최적화 방식</label>
                            <select id="cutDirection">
                                <option value="horizontal">가로 우선 (절단 편리)</option>
                                <option value="auto" selected>자동 (효율 우선)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Cost Info -->
            <section class="section" style="padding: 0;">
                <div class="accordion" id="costSettings">
                    <div class="accordion-header">
                        <span>원가 설정</span>
                        <span class="accordion-icon">▼</span>
                    </div>
                    <div class="accordion-body">
                        <div class="form-group mb-0">
                            <label>절단 단가 (자동 계산)</label>
                            <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">
                                <span id="autoCutPrice">1,500원/회</span>
                            </div>
                            <p style="font-size: 11px; color: #999; margin-top: 8px;">
                                12T 이하: 1,000원 | 14.5~23T: 1,500원 | 24T 이상: 2,000원
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Calculate Button -->
            <button class="calculate-btn" id="calculateBtn">
                최적화 계산
            </button>
        </aside>

        <!-- Center Panel: Preview -->
        <main class="center-panel" id="centerPanel">
            <!-- Controls -->
            <div class="canvas-controls-top" id="canvasControlsTop" style="display: none; margin-bottom: 16px;">
                <button class="btn btn-secondary" id="previewPdfBtn">미리보기</button>
                <button class="btn btn-primary" id="downloadPdfBtn">PDF 다운로드</button>
                <div class="share-dropdown">
                    <button class="btn btn-secondary" id="shareBtn">공유 ▾</button>
                    <div class="share-dropdown-menu" id="shareDropdownMenu">
                        <button class="share-option" data-share="email">📧 이메일</button>
                        <button class="share-option" data-share="sms">💬 문자</button>
                        <button class="share-option" data-share="copy">📋 복사</button>
                    </div>
                </div>
            </div>

            <!-- Scrollable Canvas List -->
            <div class="canvas-scroll-container" id="canvasScrollContainer"
                style="display: none; width: 100%; max-width: 800px; overflow-y: auto; max-height: calc(100vh - 200px);">
                <!-- 그룹별 대표 도면이 여기에 동적으로 생성됨 -->
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state">
                <div class="empty-state-icon">📐</div>
                <div class="empty-state-text">부품을 추가하고 최적화 계산을 실행하세요</div>
            </div>
        </main>

        <!-- Right Panel: Results -->
        <aside class="right-panel" id="rightPanel">
            <!-- Optimization Results -->
            <section class="section">
                <h2 class="section-title">최적화 결과</h2>
                <div class="result-card">
                    <div class="result-item">
                        <span class="result-label">총 판재수</span>
                        <span class="result-value" id="totalPanelCount">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">재단 횟수</span>
                        <span class="result-value" id="totalCutCount">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">총 재단비</span>
                        <span class="result-value" id="totalCuttingCost">-</span>
                    </div>
                </div>
            </section>

            <!-- Parts Summary -->
            <section class="section">
                <h2 class="section-title">부품 배치 현황</h2>
                <div id="labelGroupsList">
                    <p class="empty-state-text text-center" style="padding: 20px;">
                        계산을 실행하면 결과가 표시됩니다
                    </p>
                </div>
            </section>

            <!-- Board Navigation (for multiple boards) -->
            <section class="section hidden" id="boardNavSection">
                <h2 class="section-title">판재 선택</h2>
                <div id="boardNavList"></div>
            </section>

        </aside>
    </div>

    <!-- Scripts: Core Modules -->
    <script src="js/state.js"></script>
    <script src="js/validator.js"></script>
    <script src="js/costCalculator.js"></script>
    <script src="js/labelingEngine.js"></script>
    <script src="js/settingsManager.js"></script>
    <script src="js/packer.js"></script>
    <script src="js/renderer.js"></script>
    <script src="js/pdfGenerator.js"></script>

    <!-- Main Application Script -->
    <script src="js/main-unified.js"></script>
</body>

</html>
